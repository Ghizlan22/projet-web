document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.getElementById("file-input");
    const uploadBtn = document.getElementById("upload-btn");
    const summarizeBtn = document.getElementById("summarize-btn");
    const qaBtn = document.getElementById("qa-btn");
    const outputDiv = document.getElementById("output");

    let uploadedFile = null;  // Pour stocker le fichier s√©lectionn√©

    // üì§ 1. Gestion du fichier s√©lectionn√©
    fileInput.addEventListener("change", (event) => {
        uploadedFile = event.target.files[0];
        if (uploadedFile) {
            outputDiv.innerHTML = `<p>üìÇ Fichier s√©lectionn√© : <strong>${uploadedFile.name}</strong></p>`;
        }
    });

    // üöÄ 2. Fonction d'envoi du fichier √† l'API
    async function uploadFile(endpoint) {
        if (!uploadedFile) {
            outputDiv.innerHTML = "<p>‚ö†Ô∏è Aucun fichier s√©lectionn√©.</p>";
            return;
        }

        const formData = new FormData();
        formData.append("file", uploadedFile);

        try {
            outputDiv.innerHTML = "<p>‚è≥ Traitement en cours...</p>";

            const response = await fetch(`http://127.0.0.1:8000/${endpoint}`, {
                method: "POST",
                body: formData
            });

            const data = await response.json();
            
            if (data.error) {
                outputDiv.innerHTML = `<p>‚ùå Erreur : ${data.error}</p>`;
            } else {
                outputDiv.innerHTML = `
                    <h3>üìë R√©sum√© du document :</h3>
                    <div class="summary-box">
                        <p>${data.summary.replace(/\n/g, "<br>")}</p>
                    </div>
                `;
            }
        } catch (error) {
            outputDiv.innerHTML = `<p>‚ùå Erreur : ${error.message}</p>`;
        }
    }

    // üìë 3. Bouton "R√©sum√©" ‚Üí R√©sumer texte / interpr√©ter image
    summarizeBtn.addEventListener("click", () => {
        uploadFile("resume"); // Appelle l'API sur l'endpoint /resume
    });

    // üí° 4. Bouton "Question-R√©ponse" ‚Üí Pose une question
    qaBtn.addEventListener("click", () => {
        uploadFile("qa"); // Appelle l'API sur l'endpoint /qa
    });
});
